# New release  - step by step journal

 Applied for version 2.27, version 2.26 bellow is used only as an example.

## git

    git status

    On branch master
    Your branch is up to date with 'origin/master'.

    nothing to commit, working tree clean


## Build 

```
make distclean   # just to be sure

./autogen.sh
./configure
make distcheck
```
```
===========================================
gama-2.26 archives ready for distribution: 
gama-2.26.tar.gz
===========================================
```

## Distributing the new release

Go to the directory ```GNU/upload-gama``` and copy ```gama-2.26.tar.gz``` there.

### Copied from new-release.md 

For uploading new release tarball to the GNU FTP server, use script
```gnupload``` from directory ```build-aux``` from *GNU
portability library* (gnulib, see
https://savannah.gnu.org/git/?group=gnulib)

      git clone git://git.sv.gnu.org/gnulib.git
      ln -s gnulib/build-aux/gnupload     # create a symlink or copy ...

To upload your new release tarball, simply run

      ./gnupload --to ftp.gnu.org:gama gama-2.26.tar.gz

You will be asked for your gpg passphrase (twice) and you will get
an email when your upload is finished.

Similarly you can replace the tarball, in case it is needed

      ./gnupload --replace --to ftp.gnu.org:gama gama-2.26.tar.gz

Use ```gnupload --help``` for the full list of options with examples, you
can always try running ```gnupload``` with the option ```--dry-run```

* Note: If you encounter this error when running gnulib

      gpg: signing failed: Inappropriate ioctl for device

Simply run in the command line:

      export GPG_TTY=$(tty)

### FTP upload 2.26

```
$ ./gnupload --to ftp.gnu.org:gama gama-2.26.tar.gz 
Enter GPG passphrase: 
Signing gama-2.26.tar.gz ...
Uploading gama-2.26.tar.gz to ftp.gnu.org:gama ...
gama-2.26.tar.gz:                                       14.67 MB  797.66 kB/s  
gama-2.26.tar.gz.sig:                                  833.00 B     1.99 kB/s  
gama-2.26.tar.gz.directive.asc:                        973.00 B     2.33 kB/s  
$ 
```
### Confirmation email

After a moment
```
From ftp-upload@gnu.org
  To Me, Petra Millarova
Subject [ftp gnu-ftp-upload] fgama

upload of gama-2.26.tar.gz and gama-2.26.tar.gz.sig complete
```
We should probably ask for removal of Petra and adding you, 
also my address cepek@fsv.cvut.cz should be removed.


### Comments AÄŒ

See also https://github.com/cepek/upload-gama where I have 
kept all my files, notes, etc. 

```
cepek@dodo3:~/GNU/upload-gama (main)$ ls -l
total 30096
lrwxrwxrwx  1 cepek cepek       29 Aug 27 12:40 announce-gen -> gnulib/build-aux/announce-gen
drwxrwxr-x  5 cepek cepek     4096 Sep 29 18:39 dot.var
-rw-r--r--  1 cepek cepek      719 Nov 28  2020 FIXME_put_comments_here
drwxrwxr-x  2 cepek cepek     4096 Aug 28 15:59 ftp-gama
drwxrwxr-x  2 cepek cepek     4096 Jul 27  2022 ftp-qgama
drwxrwxr-x  3 cepek cepek     4096 Jul 27  2022 ftp-windows
lrwxrwxrwx  1 cepek cepek       23 Aug 27 21:13 gama -> /home/cepek/GNU/gama_RW
-rw-rw-r--  1 cepek cepek 15374382 Sep 26 17:46 gama-2.25.1.tar.gz
-rw-rw-r--  1 cepek cepek      833 Sep 26 17:47 gama-2.25.1.tar.gz.sig
-rw-rw-r--  1 cepek cepek 15386676 Aug 28 15:45 gama-2.25.tar.gz
-rw-rw-r--  1 cepek cepek      833 Aug 28 15:49 gama-2.25.tar.gz.sig
drwxrwxr-x 14 cepek cepek     4096 Aug 27 12:38 gnulib
lrwxrwxrwx  1 cepek cepek       25 Aug 27 13:44 gnupload -> gnulib/build-aux/gnupload
lrwxrwxrwx  1 cepek cepek        9 Aug 27 12:51 NEWS -> gama/NEWS
drwxr-xr-x  6 cepek cepek     4096 Aug 28 16:00 OLD-upload-gama
-rw-rw-r--  1 cepek cepek     1693 Aug 27 20:22 README.md
-rw-rw-r--  1 cepek cepek      856 Aug 27 13:34 README.md~
-rw-rw-r--  1 cepek cepek      538 Mar 21  2021 README_qgama.md
drwxrwxr-x  3 cepek cepek     4096 Aug 27 21:20 WEB
cepek@dodo3:~/GNU/upload-gama (main)$ 
```

## Online documentation

<!-- ### Copied from new-release.md -->
<!--This is a nightmare! Hopefully the section `Version 2.26` bellow is OK.-->

To update Gama webpages and online documentation, you need to checkout
its repository from CVS (Concurrent Version System)

      cvs -z3 -d:ext:user@cvs.savannah.gnu.org:/web/gama co -P gama

where *user* is your login name.

* For generating documentation in various formats from texinfo sources,
  download and run ```gendocs` (see ```doc/Makefile.am``` for details)

      cd gama/doc
      make download-gendocs.sh
      make run-gendocs.sh

* Copy the manual generated by the gendocs script from gama
  repository to CVS web

* Run script
      ./update-manual.sh

      #!/bin/sh

      find . -type f -name "*.html" -print0 | xargs -0 cvs add
      find . -type f -name "*.gz"   -print0 | xargs -0 cvs add
      find . -type f -name "*.pdf"  -print0 | xargs -0 cvs add
      find . -type f -name "*.txt"  -print0 | xargs -0 cvs add

      for m in html_chapter html_node html_section
      do
          echo
          echo manual/$m/.symlinks :
          cat manual/$m/.symlinks
      done

* add ```gama.html index.html``` to ```manual/html_*/.symlinks```

* remove all files index.html from manual ```find manual -name index.html```

  Run

      cvs commit .   # only cvs is available for GNU web pages, no git

<!-- ### Version 2.26

Here is what I did today:

```
cd ~/GNU/upload-gama/WEB/gama (main)$ 
```

```
cat update-manual.sh 
#!/bin/sh

find . -type f -name "*.html" -print0 | xargs -0 cvs add
find . -type f -name "*.gz"   -print0 | xargs -0 cvs add
find . -type f -name "*.pdf"  -print0 | xargs -0 cvs add
find . -type f -name "*.txt"  -print0 | xargs -0 cvs add

for m in html_chapter html_node html_section
do
    echo
    echo manual/$m/.symlinks :
    cat manual/$m/.symlinks
done
```

```
./update-manual.sh 
sv_membersh is part of Savane.
In order to download the corresponding source code of Savane, run

  rsync -avz --cvs-exclude cepek@cvs.savannah.nongnu.org:/opt/src/savane .

cvs add: `./gama.html' already exists, with version number 1.181
cvs add: `./qgama/temp.html' already exists, with version number 1.33
cvs add: `./qgama/qgama.html' already exists, with version number 1.40
cvs add: `./xml/ellipsoids.html' already exists, with version number 1.7
cvs add: `./manual/html_section/Glossary.html' already exists, with version number 1.6

************* MANY LINES SKIPPED  *********************

cvs add: `./fig/obsdata-fig.pdf' already exists, with version number 1.1
cvs add: `./manual/gama.pdf' already exists, with version number 1.48
sv_membersh is part of Savane.
In order to download the corresponding source code of Savane, run

  rsync -avz --cvs-exclude cepek@cvs.savannah.nongnu.org:/opt/src/savane .

cvs add: `./fig/obsdata-fig.txt' already exists, with version number 1.1
cvs add: `./fig/gama-local-adj-ellipse-g.txt' already exists, with version number 1.1
cvs add: `./fig/xyz2blh-fig.txt' already exists, with version number 1.1
cvs add: `./fig/gama-local-input-example.txt' already exists, with version number 1.1
cvs add: `./manual/gama.txt' already exists, with version number 1.44

manual/html_chapter/.symlinks :
../../fig fig
gama.html index.html

manual/html_node/.symlinks :
../../fig fig
gama.html index.html

manual/html_section/.symlinks :
../../fig fig
gama.html index.html
```

```
* add ```gama.html index.html``` to ```manual/html_*/.symlinks```

* remove all files index.html from manual ```find manual -name index.html```

  Run

  cvs commit .   # only cvs is available for GNU web pages, no git
```

```
cepek@dodo3:~/GNU/upload-gama/WEB/gama (main)$ find manual/ -name index.html
manual/html_section/index.html
manual/html_node/index.html
manual/index.html
manual/html_chapter/index.html
cepek@dodo3:~/GNU/upload-gama/WEB/gama (main)$ 
cepek@dodo3:~/GNU/upload-gama/WEB/gama (main)$ rm `find manual/ -name index.html`
cepek@dodo3:~/GNU/upload-gama/WEB/gama (main)$ 
```

```
cvs commit .
cvs commit: Examining .
cvs commit: Examining fig
cvs commit: Examining manual
cvs commit: Examining manual/html_chapter
cvs commit: Examining manual/html_node
cvs commit: Examining manual/html_section
cvs commit: Examining qgama
cvs commit: Examining xml
```

THE MANUAL WAS NOT UPDATED TO VERSION 2.26 !!!

Mea culpa, mea culpa maxima
```
-->

### gama/doc/README

````
1) cd gama/doc
   make download-gendocs.sh 
   make run-gendocs.sh
   
2) copy manual to gama-web
   find . -type f -print0| xargs -0 cvs add

   ###########################
   ### working alternative ###
   ###########################

   cd manual
   cvs add `find -type f | grep -v CVS`

3) copy and add .symlinks where needed (manual, manual/html_node, ...)
   example: echo ../fig fig > html_chapter/.symlinks

4) add "gama.html index.html"  in manual/html_*/.symlinks
   remove all files index.html in manual/html_*/.symlinks

5) cd web-gama
   cvs commit .
````

<!-- After repeating the previous steps manual on the web is the version 2.26.-->
